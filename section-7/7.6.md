# 7.6. “叶”声明

“`leaf`”语句用于在模型树中定义叶节点。 它有一个标识符参数，后面跟一个包含详细叶子信息的子语句块。

叶节点在数据树中有一个值，但没有子节点。 从概念上讲，数据树中的值始终是规范形式（参见[第9.1节](../section-9/9.1.md)）。

叶节点在数据树中存在零个或一个实例。

“`leaf`”语句用于声明一个内置或派生类型的单个变量。

## 7.6.1. 叶子的默认值

如果叶子不存在于数据树中，服务器就使用叶子的默认值。缺省值的使用情况取决于模型树中叶子最近的祖先节点是否为开关容器节点 （请参阅[第7.5.1节](7.5.md#751-容器的存在)）：

- 如果模型树中不存在这样的祖先(开关容器)，则必须使用默认值。

- 否则，如果这个祖先是个选择分支节点，如果数据树中存在同属本分支的任何节点，或者分支节点是所属选择节点的默认分支同时数据树中不存在任何其他分支的节点，则必须使用默认值。

- 否则，如果祖先节点存在于数据树中，则必须使用默认值。

在这些情况下，默认值被认为正在使用中。

请注意，如果叶子或其任何祖先具有“​`​when`”条件或“`if-feature`”表达式评估为“`false`”，则默认值未被使用。

当默认值正在使用时，服务器必须在操作上表现得好像数据树中存在叶子，其默认值是它的值。

如果一个叶子有一个“`default`”语句，叶子的默认值就是“`default`”语句的值。否则，如果叶子的类型有一个默认值，叶子不是强制性的，叶子的默认值就是该类型的默认值。在其他所有情况下，叶子没有默认值。

## 7.6.2.  `leaf`子语句

```
+--------------+---------+-------------+
| substatement | section | cardinality |
+--------------+---------+-------------+
| config       | 7.21.1  | 0..1        |
| default      | 7.6.4   | 0..1        |
| description  | 7.21.3  | 0..1        |
| if-feature   | 7.20.2  | 0..n        |
| mandatory    | 7.6.5   | 0..1        |
| must         | 7.5.3   | 0..n        |
| reference    | 7.21.4  | 0..1        |
| status       | 7.21.2  | 0..1        |
| type         | 7.6.3   | 1           |
| units        | 7.3.3   | 0..1        |
| when         | 7.21.5  | 0..1        |
+--------------+---------+-------------+
```

## 7.6.3. 叶的“类型”声明

必须存在的“`type`”语句将现有内置类型或派生类型的名称作为参数。 可选的子变量指定了这种类型的限制。 细节见[第7.4节](7.4.md)。

## 7.6.4. 叶子的“默认”声明

“`default`”语句是可选的，它将一个包含叶子默认值的字符串作为参数。

“`default`”语句的值必须根据叶的“`type`”语句中指定的类型有效。

“`default`”语句不能出现在“`mandatory`”为“`true`”的节点上。

默认值的定义不能用“`if-feature`”语句来标记。 例如，以下是非法的：

```YANG
leaf color {
  type enumeration {
    enum blue { if-feature blue; }
    ...
  }
  default blue; // 非法 - 枚举值是有条件的
}
```

## 7.6.5. 叶的“强制性”声明

“`mandatory`”语句是可选的，它将字符串“`true`”或“`false`”作为参数，并对有效数据进行约束。 如果未指定，则默认为“`false`”。

如果“`mandatory`”为“`true`”，那么约束的行为取决于架构树中不是不存在容器的叶节点最接近的祖先节点的类型（见[第7.5.1节](7.5.md#751-容器的存在)）：

- 如果模式树中不存在这样的祖先，叶必须存在。

- 否则，如果这个祖先是一个案例节点，如果数据树中存在任何来自案例的节点，叶子必须存在。

否则，如果祖先节点存在于数据树中，叶子必须存在。

这个约束是根据[第8节](../section-8/README.md)中的规则执行的。

## 7.6.6. `XML`编码规则

叶节点被编码为`XML`元素。 元素的本地名称是叶子的标识符，其名称空间是模块的XML名称空间（参见[第7.1.3节](7.1.md#713-namespace声明)）。

叶节点的值根据类型编码为`XML`，并作为元素中的字符数据发送。

一个例子见[7.6.8节](7.6.md#768-使用示例)。

## 7.6.7. `NETCONF` `<edit-config>`操作

当`NETCONF`服务器处理`<edit-config>`请求时，叶节点的过程元素如下：

- 如果操作是“合并(`merge`)”或“替换(`replace`)”，则创建该节点（如果该节点不存在），并将其值设置为在`XML` `RPC`数据中找到的值。

- 如果操作是“创建(`create`)”，则创建该节点（如果该节点不存在）。 如果节点已经存在，则返回“数据存在(`data-exists`)”错误。

- 如果操作是“删除(`delete`)”，则该节点将被删除（如果存在）。 如果节点不存在，则返回“数据缺失(`data-missing`)”错误。

## 7.6.8. 使用示例

鉴于下面的“`leaf`”声明，放在先前定义的“`ssh`”容器中（见[7.5.9节](7.5.md#759-使用示例)）：

```YANG
leaf port {
  type inet:port-number;
  default 22;
  description
    "The port to which the SSH server listens.";
}
```

相应的`XML`实例示例：

```xml
<port>2022</port>
```

使用`<edit-config>`设置叶子的值：

```xml
<rpc message-id="101"
     xmlns="urn:ietf:params:xml:ns:netconf:base:1.0"
     xmlns:nc="urn:ietf:params:xml:ns:netconf:base:1.0">
  <edit-config>
    <target>
      <running/>
    </target>
    <config>
      <system xmlns="urn:example:config">
        <services>
          <ssh>
            <port>2022</port>
          </ssh>
        </services>
      </system>
    </config>
  </edit-config>
</rpc>
```
